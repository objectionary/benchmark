# SPDX-FileCopyrightText: Copyright (c) 2023-2025 Objectionary.com
# SPDX-License-Identifier: MIT
---
# yamllint disable rule:line-length
name: invokeinterface-to-lambda
pattern: |
  âŸ¦
    ğµ-body-head,
    ğœ-invokedynamic â†¦ âŸ¦
      Ï† â†¦ Î¦.jeo.opcode.invokedynamic,
      ğœ3 â†¦ ğ‘’-method-name,
      ğœ4 â†¦ ğ‘’-interface-name,
      ğœ5 â†¦ âŸ¦
        Ï† â†¦ Î¦.jeo.handle,
        ğœ6 â†¦ 6,
        ğœ7 â†¦ "java/lang/invoke/LambdaMetafactory",
        ğœ8 â†¦ "metafactory",
        ğœ9 â†¦ "(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;",
        ğœ10 â†¦ Î¦Ì‡.false,
        ğµ10
      âŸ§,
      ğœ11 â†¦ âŸ¦
        Ï† â†¦ Î¦.jeo.type,
        ğœ12 â†¦ ğ‘’-signature,
        ğµ11
      âŸ§,
      ğœ13 â†¦ âŸ¦
        Ï† â†¦ Î¦.jeo.handle,
        ğœ14 â†¦ 6,
        ğœ15 â†¦ ğ‘’-class-name,
        ğœ16 â†¦ ğ‘’-target-method-name,
        ğœ17 â†¦ ğ‘’-target-signature,
        ğœ18 â†¦ Î¦Ì‡.false,
        ğµ12
      âŸ§,
      ğœ19 â†¦ âŸ¦
        Ï† â†¦ Î¦.jeo.type,
        ğœ21 â†¦ ğ‘’-intermediate-signature,
        ğµ13
      âŸ§,
      ğµ14
    âŸ§,
    ğœ-invokeinterface â†¦ âŸ¦
      Ï† â†¦ Î¦.jeo.opcode.invokeinterface,
      ğœ24 â†¦ ğ‘’-stream-class-name,
      ğœ25 â†¦ ğ‘’-stream-method-name,
      ğœ26 â†¦ ğ‘’-stream-signature,
      ğœ27 â†¦ Î¦Ì‡.true,
      ğµ15
    âŸ§,
    ğµ-body-tail
  âŸ§
result: |
  âŸ¦
    ğµ-body-head,
    ğœ-lambda â†¦ âŸ¦
      Ï† â†¦ Î¦.hone.lambda,
      method â†¦ ğ‘’-method-name,
      interface â†¦ ğ‘’-interface-name,
      signature â†¦ ğ‘’-signature,
      target-class â†¦ ğ‘’-class-name,
      target-method â†¦ ğ‘’-target-method-name,
      target-signature â†¦ ğ‘’-target-signature,
      intermediate-signature â†¦ ğ‘’-intermediate-signature,
      stream-class â†¦ ğ‘’-stream-class-name,
      stream-method â†¦ ğ‘’-stream-method-name,
      stream-signature â†¦ ğ‘’-stream-signature
    âŸ§,
    ğµ-body-tail
  âŸ§
where:
  - meta: ğœ-lambda
    function: random-tau
    args: ['ğµ-body-head', 'ğµ-body-tail', 'ğœ-invokeinterface', 'ğœ-invokedynamic']
