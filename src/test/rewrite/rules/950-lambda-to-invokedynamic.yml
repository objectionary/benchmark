# SPDX-FileCopyrightText: Copyright (c) 2023-2025 Objectionary.com
# SPDX-License-Identifier: MIT
---
# yamllint disable rule:line-length
name: lambda-to-invokeinterface
pattern: |
  âŸ¦
    ğµ1,
    ğœ1 â†¦ âŸ¦
      base â†¦ "Q.hone.lambda",
      method â†¦ ğ‘’-method-name,
      interface â†¦ ğ‘’-interface-name,
      signature â†¦ ğ‘’-signature,
      target-class â†¦ ğ‘’-class-name,
      target-method â†¦ ğ‘’-target-method-name,
      target-signature â†¦ ğ‘’-target-signature,
      intermediate-signature â†¦ ğ‘’-intermediate-signature,
      stream-class â†¦ ğ‘’-stream-class-name,
      stream-method â†¦ ğ‘’-stream-method-name,
      stream-signature â†¦ ğ‘’-stream-signature
    âŸ§,
    ğµ2
  âŸ§
result: |
  âŸ¦
    ğµ1,
    ğœ-invokedynamic â†¦ âŸ¦
      base â†¦ "Q.jeo.opcode.invokedynamic",
      i1 â†¦ 186,
      i2 â†¦ ğ‘’-method-name,
      i3 â†¦ ğ‘’-interface-name,
      i4 â†¦ âŸ¦
        base â†¦ "Q.jeo.handle",
        i1 â†¦ 6,
        i2 â†¦ "java/lang/invoke/LambdaMetafactory",
        i3 â†¦ "metafactory",
        i4 â†¦ "(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;",
        i5 â†¦ Î¦Ì‡.false
      âŸ§,
      i5 â†¦ âŸ¦
        base â†¦ "Q.jeo.type",
        i1 â†¦ ğ‘’-signature
      âŸ§,
      i6 â†¦ âŸ¦
        base â†¦ "Q.jeo.handle",
        i1 â†¦ 6,
        i2 â†¦ ğ‘’-class-name,
        i3 â†¦ ğ‘’-target-method-name,
        i4 â†¦ ğ‘’-target-signature,
        i5 â†¦ Î¦Ì‡.false
      âŸ§,
      i7 â†¦ âŸ¦
        base â†¦ "Q.jeo.type",
        i1 â†¦ ğ‘’-intermediate-signature
      âŸ§
    âŸ§,
    ğœ-invokeinterface â†¦ âŸ¦
      base â†¦ "Q.jeo.opcode.invokeinterface",
      i1 â†¦ 185,
      i2 â†¦ ğ‘’-stream-class-name,
      i3 â†¦ ğ‘’-stream-method-name,
      i4 â†¦ ğ‘’-stream-signature,
      i5 â†¦ Î¦Ì‡.true
    âŸ§,
    ğµ2
  âŸ§
where:
  - meta: ğœ-invokedynamic
    function: random-tau
    args: [ 'ğµ1', 'ğµ2' ]
  - meta: ğœ-invokeinterface
    function: random-tau
    args: [ 'ğµ1', 'ğœ-invokedynamic', 'ğµ2' ]
