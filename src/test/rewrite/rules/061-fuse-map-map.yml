# SPDX-FileCopyrightText: Copyright (c) 2023-2025 Objectionary.com
# SPDX-License-Identifier: MIT
---
# yamllint disable rule:line-length
name: fuse-map-map
pattern: |
  âŸ¦
    ğµ0,
    ğœ-class â†¦ âŸ¦
      base â†¦ "Q.jeo.class",
      ğµ1,
      ğœ-method â†¦ âŸ¦
        base â†¦ "Q.jeo.method",
        ğµ2,
        body â†¦ âŸ¦
          ğµ3,
          ğœ-first â†¦ âŸ¦
            base â†¦ "Q.hone.map",
            class â†¦ ğ‘’-class-name,
            method â†¦ ğ‘’-first-method-name,
            in â†¦ ğ‘’-first-input-type,
            out â†¦ ğ‘’-first-output-type,
            ğµ4
          âŸ§,
          ğœ-second â†¦ âŸ¦
            base â†¦ "Q.hone.map",
            class â†¦ ğ‘’-class-name,
            method â†¦ ğ‘’-second-method-name,
            in â†¦ ğ‘’-second-input-type,
            out â†¦ ğ‘’-second-output-type,
            ğµ5
          âŸ§,
          ğµ6
        âŸ§,
        ğµ7
      âŸ§,
      ğµ8
    âŸ§,
    ğµ9
  âŸ§
result: |
  âŸ¦
    ğµ0,
    ğœ-class â†¦ âŸ¦
      base â†¦ "Q.jeo.class",
      ğµ1,
      ğœ-method â†¦ âŸ¦
        base â†¦ "Q.jeo.method",
        ğµ2,
        body â†¦ âŸ¦
          ğµ3,
          ğœ-first â†¦ âŸ¦
            base â†¦ "Q.hone.map",
            class â†¦ ğ‘’-class-name,
            method â†¦ ğ‘’-fuse-method-name,
            in â†¦ ğ‘’-first-input-type,
            out â†¦ ğ‘’-second-output-type
          âŸ§,
          ğµ6
        âŸ§,
        ğµ7
      âŸ§,
      ğµ8,
      ğœ-fuse â†¦ âŸ¦
        base â†¦ "Q.jeo.method",
        access â†¦ 4106,
        descriptor â†¦ ğ‘’-fuse-descriptor,
        signature â†¦ "",
        maxs â†¦ âŸ¦
          base â†¦ "Q.jeo.maxs",
          i1 â†¦ 1,
          i2 â†¦ 1
        âŸ§,
        params â†¦ âŸ¦
          base â†¦ "Q.jeo.params",
          i1 â†¦ âŸ¦
            base â†¦ "Q.jeo.param",
            index â†¦ 0,
            access â†¦ 0,
            type â†¦ ğ‘’-first-input-type
          âŸ§
        âŸ§,
        body â†¦ âŸ¦
          base â†¦ "Q.jeo.seq.of5",
          i1 â†¦ âŸ¦
            base â†¦ "Q.jeo.opcode.aload",
            i1 â†¦ 25,
            i1 â†¦ 0
          âŸ§,
          i2 â†¦ âŸ¦
            base â†¦ "Q.jeo.opcode.invokestatic",
            i1 â†¦ 184,
            i2 â†¦ ğ‘’-class-name,
            i3 â†¦ ğ‘’-first-method-name,
            i4 â†¦ ğ‘’-first-descriptor,
            i5 â†¦ Î¦Ì‡.false
          âŸ§,
          i3 â†¦ âŸ¦
            base â†¦ "Q.jeo.opcode.invokestatic",
            i1 â†¦ 184,
            i2 â†¦ ğ‘’-class-name,
            i3 â†¦ ğ‘’-second-method-name,
            i4 â†¦ ğ‘’-second-descriptor,
            i5 â†¦ Î¦Ì‡.false
          âŸ§,
          i4 â†¦ âŸ¦
            base â†¦ "Q.jeo.opcode.areturn",
            i1 â†¦ 176
          âŸ§
        âŸ§,
        name â†¦ ğ‘’-fuse-method-name
      âŸ§
    âŸ§,
    ğµ9
  âŸ§
where:
  - meta: ğœ-fuse
    function: random-tau
    args: ['base', 'ğµ1', 'ğµ8', 'ğœ1']
  - meta: ğ‘’-fuse-method-name
    function: concat
    args:
      - ğ‘’-first-method-name
      - '"_fuse"'
  - meta: ğ‘’-fuse-descriptor
    function: concat
    args:
      - '"("'
      - ğ‘’-first-input-type
      - '")"'
      - ğ‘’-second-output-type
  - meta: ğ‘’-first-descriptor
    function: concat
    args:
      - '"("'
      - ğ‘’-first-input-type
      - '")"'
      - ğ‘’-first-output-type
  - meta: ğ‘’-second-descriptor
    function: concat
    args:
      - '"("'
      - ğ‘’-second-input-type
      - '")"'
      - ğ‘’-second-output-type
