# SPDX-FileCopyrightText: Copyright (c) 2023-2025 Objectionary.com
# SPDX-License-Identifier: MIT
---
# yamllint disable rule:line-length
name: bipredicate-for-predicate
pattern: |
  ⟦
    𝐵0,
    𝜏-class ↦ ⟦
      φ ↦ Φ.jeo.class,
      𝐵1,
      name ↦ 𝑒-class-name,
      𝐵2,
      𝜏1 ↦ ⟦
        φ ↦ Φ.jeo.method,
        access ↦ 4106,
        descriptor ↦ 𝑒-predicate-descriptor,
        signature ↦ "",
        maxs ↦ ⟦
          φ ↦ Φ.jeo.maxs,
          𝜏3 ↦ 𝑒-max-stack,
          𝜏4 ↦ 𝑒-max-locals,
          𝐵3
        ⟧,
        params ↦ ⟦
          φ ↦ Φ.jeo.params,
          𝜏5 ↦ ⟦
            φ ↦ Φ.jeo.param,
            index ↦ 0,
            access ↦ 0,
            type ↦ 𝑒-predicate-input-type
          ⟧,
          𝐵4
        ⟧,
        body ↦ 𝑒-body,
        name ↦ 𝑒-predicate-name,
        𝐵5
      ⟧,
      𝐵6
    ⟧,
    𝐵7
  ⟧
result: |
  ⟦
    𝐵0,
    𝜏-class ↦ ⟦
      φ ↦ Φ.jeo.class,
      𝐵1,
      name ↦ 𝑒-class-name,
      𝐵2,
      𝜏1 ↦ ⟦
        φ ↦ Φ.jeo.method,
        access ↦ 4106,
        descriptor ↦ 𝑒-predicate-descriptor,
        signature ↦ "",
        maxs ↦ ⟦
          φ ↦ Φ.jeo.maxs,
          max-stack ↦ 𝑒-max-stack,
          max-locals ↦ 𝑒-max-locals
        ⟧,
        params ↦ ⟦
          φ ↦ Φ.jeo.params,
          i1 ↦ ⟦
            φ ↦ Φ.jeo.param,
            index ↦ 0,
            access ↦ 0,
            type ↦ 𝑒-predicate-input-type
          ⟧,
          𝐵4
        ⟧,
        body ↦ 𝑒-body,
        name ↦ 𝑒-predicate-name,
        𝐵5
      ⟧,
      𝐵6,
      𝜏-bipredicate ↦ ⟦
        φ ↦ Φ.jeo.method,
        access ↦ 4106,
        descriptor ↦ 𝑒-bipredicate-descriptor,
        signature ↦ "",
        maxs ↦ ⟦
          φ ↦ Φ.jeo.maxs,
          max-stack ↦ 2,
          max-locals ↦ 2
        ⟧,
        params ↦ ⟦
          φ ↦ Φ.jeo.params,
          i1 ↦ ⟦
            φ ↦ Φ.jeo.param,
            index ↦ 0,
            access ↦ 0,
            type ↦ 𝑒-predicate-input-type
          ⟧,
          i2 ↦ ⟦
            φ ↦ Φ.jeo.param,
            index ↦ 1,
            access ↦ 0,
            type ↦ "Ljava/util/function/Consumer;"
          ⟧
        ⟧,
        body ↦ ⟦
          φ ↦ Φ.jeo.seq.of5,
          i-pop-item ↦ ⟦
            φ ↦ Φ.jeo.opcode.aload,
            i1 ↦ 25,
            i1 ↦ 1
          ⟧,
          i-pop-consumer ↦ ⟦
            φ ↦ Φ.jeo.opcode.aload,
            i1 ↦ 25,
            i1 ↦ 0
          ⟧,
          i2 ↦ ⟦
            φ ↦ Φ.jeo.opcode.invokestatic,
            i1 ↦ 184,
            i2 ↦ 𝑒-class-name,
            i3 ↦ 𝑒-predicate-name,
            i4 ↦ 𝑒-predicate-descriptor,
            i5 ↦ Φ̇.false
          ⟧,
          i3 ↦ ⟦
            φ ↦ Φ.jeo.opcode.ifne,
            i1 ↦ 154,
            i2 ↦ ⟦
              φ ↦ Φ.jeo.label,
              i1 ↦ Φ̇.bytes(
                ⟦
                  Δ ⤍ 4C-32-30-32-38-30-34-32-39-30-35
                ⟧
              )
            ⟧
          ⟧,
          i4 ↦ ⟦
            φ ↦ Φ.jeo.opcode.return,
            i1 ↦ 177
          ⟧,
          i5 ↦ ⟦
            φ ↦ Φ.jeo.label,
            i1 ↦ Φ̇.bytes(
              ⟦
                Δ ⤍ 4C-32-30-32-38-30-34-32-39-30-35
              ⟧
            )
          ⟧,
          i6 ↦ ⟦
            φ ↦ Φ.jeo.frame,
            i1 ↦ 3,
            i3 ↦ 0,
            i3 ↦ ⟦
              φ ↦ Φ.jeo.seq.of0
            ⟧,
            i4 ↦ 0,
            i5 ↦ ⟦
              φ ↦ Φ.jeo.seq.of0
            ⟧
          ⟧,
          i-invoke ↦ ⟦
            φ ↦ Φ.jeo.opcode.invokeinterface,
            i1 ↦ 185,
            i2 ↦ "java/util/function/Consumer",
            i3 ↦ "accept",
            i4 ↦ "(Ljava/lang/Object;)V",
            i5 ↦ Φ̇.true
          ⟧,
          i-return ↦ ⟦
            φ ↦ Φ.jeo.opcode.return,
            i1 ↦ 177
          ⟧
        ⟧,
        name ↦ 𝑒-bipredicate-name
      ⟧
    ⟧,
    𝐵7
  ⟧
when:
  and:
    - matches:
        - '\(L[a-zA-Z0-9_$/]+;\)Z'
        - 𝑒-predicate-descriptor
where:
  - meta: 𝜏-bipredicate
    function: random-tau
    args: ['base', 'name', '𝐵1', '𝐵2', '𝐵3', '𝐵6']
  - meta: 𝑒-bipredicate-name
    function: concat
    args:
      - 𝑒-predicate-name
      - '"_bipredicate"'
  - meta: 𝑒-bipredicate-descriptor
    function: concat
    args:
      - '"("'
      - 𝑒-predicate-input-type
      - '"Ljava/util/function/Consumer;)V"'
having:
  not:
    part-of:
      - 𝑒-bipredicate-name
      - 𝐵6
