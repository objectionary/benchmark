# SPDX-FileCopyrightText: Copyright (c) 2023-2025 Objectionary.com
# SPDX-License-Identifier: MIT
---
# yamllint disable rule:line-length
name: bipredicate-for-predicate
pattern: |
  âŸ¦
    ğµ0,
    ğœ-class â†¦ âŸ¦
      Ï† â†¦ Î¦.jeo.class,
      ğµ1,
      name â†¦ ğ‘’-class-name,
      ğµ2,
      ğœ1 â†¦ âŸ¦
        Ï† â†¦ Î¦.jeo.method,
        access â†¦ 4106,
        descriptor â†¦ ğ‘’-predicate-descriptor,
        signature â†¦ "",
        maxs â†¦ âŸ¦
          Ï† â†¦ Î¦.jeo.maxs,
          ğœ3 â†¦ ğ‘’-max-stack,
          ğœ4 â†¦ ğ‘’-max-locals,
          ğµ3
        âŸ§,
        params â†¦ âŸ¦
          Ï† â†¦ Î¦.jeo.params,
          ğœ5 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.param,
            index â†¦ 0,
            access â†¦ 0,
            type â†¦ ğ‘’-predicate-input-type
          âŸ§,
          ğµ4
        âŸ§,
        body â†¦ ğ‘’-body,
        name â†¦ ğ‘’-predicate-name,
        ğµ5
      âŸ§,
      ğµ6
    âŸ§,
    ğµ7
  âŸ§
result: |
  âŸ¦
    ğµ0,
    ğœ-class â†¦ âŸ¦
      Ï† â†¦ Î¦.jeo.class,
      ğµ1,
      name â†¦ ğ‘’-class-name,
      ğµ2,
      ğœ1 â†¦ âŸ¦
        Ï† â†¦ Î¦.jeo.method,
        access â†¦ 4106,
        descriptor â†¦ ğ‘’-predicate-descriptor,
        signature â†¦ "",
        maxs â†¦ âŸ¦
          Ï† â†¦ Î¦.jeo.maxs,
          max-stack â†¦ ğ‘’-max-stack,
          max-locals â†¦ ğ‘’-max-locals
        âŸ§,
        params â†¦ âŸ¦
          Ï† â†¦ Î¦.jeo.params,
          i1 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.param,
            index â†¦ 0,
            access â†¦ 0,
            type â†¦ ğ‘’-predicate-input-type
          âŸ§,
          ğµ4
        âŸ§,
        body â†¦ ğ‘’-body,
        name â†¦ ğ‘’-predicate-name,
        ğµ5
      âŸ§,
      ğµ6,
      ğœ-bipredicate â†¦ âŸ¦
        Ï† â†¦ Î¦.jeo.method,
        access â†¦ 4106,
        descriptor â†¦ ğ‘’-bipredicate-descriptor,
        signature â†¦ "",
        maxs â†¦ âŸ¦
          Ï† â†¦ Î¦.jeo.maxs,
          max-stack â†¦ 2,
          max-locals â†¦ 2
        âŸ§,
        params â†¦ âŸ¦
          Ï† â†¦ Î¦.jeo.params,
          i1 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.param,
            index â†¦ 0,
            access â†¦ 0,
            type â†¦ ğ‘’-predicate-input-type
          âŸ§,
          i2 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.param,
            index â†¦ 1,
            access â†¦ 0,
            type â†¦ "Ljava/util/function/Consumer;"
          âŸ§
        âŸ§,
        body â†¦ âŸ¦
          Ï† â†¦ Î¦.jeo.seq.of5,
          i-pop-item â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.opcode.aload,
            i1 â†¦ 25,
            i1 â†¦ 1
          âŸ§,
          i-pop-consumer â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.opcode.aload,
            i1 â†¦ 25,
            i1 â†¦ 0
          âŸ§,
          i2 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.opcode.invokestatic,
            i1 â†¦ 184,
            i2 â†¦ ğ‘’-class-name,
            i3 â†¦ ğ‘’-predicate-name,
            i4 â†¦ ğ‘’-predicate-descriptor,
            i5 â†¦ Î¦Ì‡.false
          âŸ§,
          i3 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.opcode.ifne,
            i1 â†¦ 154,
            i2 â†¦ âŸ¦
              Ï† â†¦ Î¦.jeo.label,
              i1 â†¦ Î¦Ì‡.bytes(
                âŸ¦
                  Î” â¤ 4C-32-30-32-38-30-34-32-39-30-35
                âŸ§
              )
            âŸ§
          âŸ§,
          i4 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.opcode.return,
            i1 â†¦ 177
          âŸ§,
          i5 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.label,
            i1 â†¦ Î¦Ì‡.bytes(
              âŸ¦
                Î” â¤ 4C-32-30-32-38-30-34-32-39-30-35
              âŸ§
            )
          âŸ§,
          i6 â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.frame,
            i1 â†¦ 3,
            i3 â†¦ 0,
            i3 â†¦ âŸ¦
              Ï† â†¦ Î¦.jeo.seq.of0
            âŸ§,
            i4 â†¦ 0,
            i5 â†¦ âŸ¦
              Ï† â†¦ Î¦.jeo.seq.of0
            âŸ§
          âŸ§,
          i-invoke â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.opcode.invokeinterface,
            i1 â†¦ 185,
            i2 â†¦ "java/util/function/Consumer",
            i3 â†¦ "accept",
            i4 â†¦ "(Ljava/lang/Object;)V",
            i5 â†¦ Î¦Ì‡.true
          âŸ§,
          i-return â†¦ âŸ¦
            Ï† â†¦ Î¦.jeo.opcode.return,
            i1 â†¦ 177
          âŸ§
        âŸ§,
        name â†¦ ğ‘’-bipredicate-name
      âŸ§
    âŸ§,
    ğµ7
  âŸ§
when:
  and:
    - matches:
        - '\(L[a-zA-Z0-9_$/]+;\)Z'
        - ğ‘’-predicate-descriptor
where:
  - meta: ğœ-bipredicate
    function: random-tau
    args: ['base', 'name', 'ğµ1', 'ğµ2', 'ğµ3', 'ğµ6']
  - meta: ğ‘’-bipredicate-name
    function: concat
    args:
      - ğ‘’-predicate-name
      - '"_bipredicate"'
  - meta: ğ‘’-bipredicate-descriptor
    function: concat
    args:
      - '"("'
      - ğ‘’-predicate-input-type
      - '"Ljava/util/function/Consumer;)V"'
having:
  not:
    part-of:
      - ğ‘’-bipredicate-name
      - ğµ6
